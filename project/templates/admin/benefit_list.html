{% extends 'admin/base_admin.html' %}

{% block page_title %}Gerenciar Benefícios{% endblock %}

{% block content %}
<div class="mb-6 flex items-center justify-between">
    <div class="flex-1 max-w-lg">
        <form method="get" class="relative">
            <input type="text" name="search" value="{{ search }}" placeholder="Buscar benefícios..." class="w-full px-4 py-3 pl-12 rounded-lg border border-gray-300 focus:border-primary focus:ring-2 focus:ring-cyan-200 transition">
            <i class="fas fa-search absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
        </form>
    </div>
    <a href="{% url 'admin-benefit-create' %}" class="ml-4 bg-gradient-to-r from-cyan-400 to-blue-400 text-white px-6 py-3 rounded-lg hover:from-cyan-500 hover:to-blue-500 transition font-medium">
        <i class="fas fa-plus mr-2"></i>
        Novo Benefício
    </a>
</div>

{% if benefits %}
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    {% for benefit in benefits %}
    <div class="bg-white rounded-xl shadow-sm p-6 hover:shadow-md transition">
        <div class="flex items-start justify-between mb-4">
            <div class="flex items-center">
                {% if benefit.icon %}
                <span class="text-3xl mr-3">{{ benefit.icon }}</span>
                {% endif %}
                <div>
                    <h3 class="font-semibold text-gray-900 text-lg">{{ benefit.name }}</h3>
                    <p class="text-sm text-gray-500 mt-1">Em {{ benefit.plan_count }} plano{{ benefit.plan_count|pluralize }}</p>
                </div>
            </div>
            {% if benefit.is_active %}
            <span class="px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full">Ativo</span>
            {% else %}
            <span class="px-2 py-1 bg-gray-100 text-gray-800 text-xs font-medium rounded-full">Inativo</span>
            {% endif %}
        </div>
        
        <p class="text-gray-600 text-sm mb-4 line-clamp-3">{{ benefit.description }}</p>
        
        <div class="flex items-center justify-end space-x-2 pt-4 border-t border-gray-200">
            <a href="{% url 'admin-benefit-edit' benefit.id %}" class="inline-flex items-center px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition text-sm font-medium">
                <i class="fas fa-edit mr-2"></i>Editar
            </a>
            <button onclick="confirmDelete({{ benefit.id }}, '{{ benefit.name }}')" class="inline-flex items-center px-4 py-2 bg-red-50 text-red-600 rounded-lg hover:bg-red-100 transition text-sm font-medium">
                <i class="fas fa-trash mr-2"></i>Excluir
            </button>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="bg-white rounded-xl shadow-sm p-12 text-center">
    <i class="fas fa-star text-6xl text-gray-300 mb-4"></i>
    <h3 class="text-xl font-semibold text-gray-700 mb-2">Nenhum benefício encontrado</h3>
    <p class="text-gray-500 mb-6">Comece criando seu primeiro benefício</p>
    <a href="{% url 'admin-benefit-create' %}" class="inline-flex items-center px-6 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition font-medium">
        <i class="fas fa-plus mr-2"></i>
        Criar Benefício
    </a>
</div>
{% endif %}
{% endblock %}

{% block extra_scripts %}
<script>
function confirmDelete(benefitId, benefitName) {
    Swal.fire({
        title: 'Confirmar Exclusão',
        html: `Tem certeza que deseja excluir o benefício <strong>${benefitName}</strong>?<br><small class="text-gray-500">Esta ação não pode ser desfeita.</small>`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Sim, excluir',
        cancelButtonText: 'Cancelar',
        customClass: {
            confirmButton: 'bg-red-500 text-white hover:bg-red-600 px-6 py-2 rounded-lg transition mr-2',
            cancelButton: 'bg-gray-300 text-gray-700 hover:bg-gray-400 px-6 py-2 rounded-lg transition'
        },
        buttonsStyling: false
    }).then((result) => {
        if (result.isConfirmed) {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/admin/benefits/${benefitId}/delete/`;
            
            const csrf = document.createElement('input');
            csrf.type = 'hidden';
            csrf.name = 'csrfmiddlewaretoken';
            csrf.value = '{{ csrf_token }}';
            form.appendChild(csrf);
            
            document.body.appendChild(form);
            form.submit();
        }
    });
}
</script>
{% endblock %}
